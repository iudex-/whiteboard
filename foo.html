<!DOCTYPE html>
<html>
<head>
<title>whiteboard</title>
</head>
<body onload(foo)>
<canvas id="canvas" width="500" height="500" style="border: 1px solid black;"></canvas>
<div>
	<span id="x"></span>
	<span id="y"></span>
</div>
<script src="./socket.io/socket.io.js"></script>
<script>
var points = [];

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
ctx.fillStyle = "#ff0000";
ctx.strokeStyle = "#ff0000";
ctx.lineWidth = 3.0;
ctx.lineCap = 'round';
ctx.lineJoin = 'round';

var xx = document.getElementById('x');
var yy = document.getElementById('y');

ctx.beginPath();
var x = null;
var y = null;
var draw = false;

canvas.onmousedown = function(e) {
	x = e.clientX;
	y = e.clientY;
	x -= canvas.offsetLeft;
	y -= canvas.offsetTop;
	draw = true;
	xx.innerHTML = x;
	yy.innerHTML = y;

	ctx.closePath();
	ctx.arc(x, y, 2, 0, Math.PI*2, true); 
	ctx.closePath();
	ctx.fill();
	ctx.beginPath();

	ctx.moveTo(x, y);
	points[points.length] = [x,y];
};

canvas.onmouseup = function(e) {
	draw = false;
	//console.log(points);
	if(points.length>0) {
		send(JSON.stringify(points));
	}
	points = [];
};
canvas.onmousemove = function(e) {
	x = e.clientX;
	y = e.clientY;
	x -= canvas.offsetLeft;
	y -= canvas.offsetTop;
	xx.innerHTML = x;
	yy.innerHTML = y;

	if (!draw) {
		return;
	}
	
	ctx.lineTo(x, y);
	ctx.stroke();
	ctx.moveTo(x, y);
	points[points.length] = [x,y];
};

var drawpoints = function(a) {
	ctx.closePath();
	ctx.beginPath();
	if(a.length>1) {
		ctx.moveTo(a[0][0], a[0][1]);
		for(var i=0; i<a.length; i++) {
			var point = a[i];
			ctx.lineTo(point[0], point[1]);
			ctx.stroke();
			ctx.moveTo(point[0], point[1]);
		}
	} else if(a.length=1) {
		ctx.arc(a[0][0], a[0][1], 2, 0, Math.PI*2, true); 
		ctx.closePath();
		ctx.fill();
	}
	ctx.beginPath();
};

var socket = new io.connect();
console.log(socket);
socket.on('connect',function() {
	console.log('Client has connected to the server!');
});
socket.on('message', function(data){
		console.log(data);
		drawpoints(JSON.parse(data));
	});

socket.on('disconnect',function() {
	console.log('The client has disconnected!');
});
function send(message) {
	socket.send(message);
}
</script>
</body>
